# Include section
[include fluidd.cfg]
[include mainsail.cfg]
[include timelapse.cfg]
[include config_backup.cfg]
[include macros/*.cfg]
[include macros/Base/*.cfg]
[include macros/Calibration/*.cfg]
[include macros/Helpers/*.cfg]
[include KAMP_Settings.cfg]
[include lcd_tweaks.cfg]

# Define MCUs
[mcu]
canbus_uuid: 504516a1914e
# serial: /dev/serial/by-id/<your-mcu-id>

[mcu host]
serial: /tmp/klipper_host_mcu

[mcu display]
serial: /dev/serial/by-id/usb-Klipper_stm32f042x6_22000F001043305645303820-if00
restart_method: command

[mcu expander]
serial: /dev/serial/by-id/usb-Klipper_stm32f042x6_2D0003800343305555323920-if00
restart_method: command

[mcu SHT36PRO]
canbus_uuid: baf453e850e2

# Printer basics
[printer]
kinematics: corexy
max_velocity: 800
max_accel: 10000
max_z_velocity: 30
max_z_accel: 100

[input_shaper]
shaper_freq_x: 90.2
shaper_type_x: ei
shaper_freq_y: 84.6
shaper_type_y: ei
damping_ratio_x: 0.060
damping_ratio_y: 0.036

[firmware_retraction]
retract_length: 0.6
retract_speed: 60
unretract_extra_length: 0
unretract_speed: 60

# Steppers
[stepper_x]
step_pin: X_STEP
dir_pin: !X_DIR
enable_pin: !X_EN
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 200
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_endstop: 121
position_max: 121
homing_speed: 50
homing_retract_dist: 0
homing_positive_dir: true
step_pulse_duration: 0.000004

[tmc2209 stepper_x]
uart_pin: X_CS
interpolate: True
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 0
diag_pin: PA4
driver_sgthrs: 95

[autotune_tmc stepper_x]
motor: siboor-35sth52-1204a
tuning_goal: silent
sg4_thrs: 95

[stepper_y]
step_pin: Y_STEP
dir_pin: !Y_DIR
enable_pin: !Y_EN
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 200
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_endstop: 122
position_max: 122
homing_speed: 50
homing_retract_dist: 0
homing_positive_dir: true
step_pulse_duration: 0.000004

[tmc2209 stepper_y]
uart_pin: Y_CS
interpolate: True
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 0
diag_pin: PA5
driver_sgthrs: 95

[autotune_tmc stepper_y]
motor: siboor-35sth52-1204a
tuning_goal: silent
sg4_thrs: 95

[stepper_z]
step_pin: Z_STEP
dir_pin: !Z_DIR
enable_pin: !Z_EN
rotation_distance: 8
microsteps: 16
endstop_pin: Z_STOP
position_max: 122
position_min: -1
homing_speed: 120
second_homing_speed: 3.0
homing_retract_dist: 3.0
#position_endstop: 120.400

[tmc2209 stepper_z]
uart_pin: Z_CS
run_current: 0.5500
interpolate: False

[autotune_tmc stepper_z]
motor: siboor-42sth26-0804a
tuning_goal: silent

[extruder]
step_pin: SHT36PRO:gpio23
dir_pin: SHT36PRO:gpio24
enable_pin: !SHT36PRO:gpio25
gear_ratio: 44:8, 37:17      # Pap Lite
# rotation_distance: 56.2      # Pap Lite
rotation_distance: 57
# gear_ratio: 9:1            # Galileo 2
# rotation_distance: 47.088  # Galileo 2
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
max_extrude_cross_section: 5
max_extrude_only_distance: 200
heater_pin: SHT36PRO:gpio8
sensor_pin: SHT36PRO:gpio26
sensor_type: ATC Semitec 104GT-2
min_temp: 0
max_temp: 350
max_power: 1.0
min_extrude_temp: 10
step_pulse_duration: 0.000004
#control: pid
#pid_kp: 43.632
#pid_ki: 6.464
#pid_kd: 73.629

[tmc5160 extruder]
cs_pin: SHT36PRO:gpio20
spi_software_sclk_pin: SHT36PRO:gpio10
spi_software_mosi_pin: SHT36PRO:gpio11
spi_software_miso_pin: SHT36PRO:gpio12
interpolate: False
run_current: 0.75 # LDO-36STH20-1004AHG and MOONS CSE14RA1L410A
# run_current: 0.6  # LDO-36SHT20-1004AHG-9T
sense_resistor: 0.075
stealthchop_threshold: 0

[autotune_tmc extruder]
# motor: ldo-36sth20-1004ahg-9T
motor: moons-cse14hra1l410a
tuning_goal: performance

# Bed
[heater_bed]
heater_pin: BED_OUT
sensor_pin: BED_TEMP
sensor_type: ATC Semitec 104GT-2
min_temp: -100
max_temp: 125
max_power: 1.0
#control: pid
#pid_kp: 58.230
#pid_ki: 2.441
#pid_kd: 347.194

[bed_screws]
screw1: 60,5
screw1_name: front screw
screw2: 5,115
screw2_name: back left
screw3: 115,115
screw3_name: back right
probe_height: 0.1

# Temperature Sensors
[temperature_fan MCU]
pin: expander:PA1
kick_start_time: 0.500
sensor_type: temperature_mcu
control: watermark
target_temp: 55.0
max_delta: 3
min_temp: 0
max_temp: 90
max_speed: 1.0
min_speed: 0.5

[temperature_sensor FLY-Gemini]
sensor_type: temperature_host

[temperature_sensor chamber]
sensor_type: ATC Semitec 104GT-2
sensor_pin: expander:PA6
gcode_id: T1

[temperature_sensor Toolhead]
sensor_type: temperature_mcu
sensor_mcu: SHT36PRO

[temperature_sensor Toolhead_Chamber]
sensor_type: ATC Semitec 104GT-2
sensor_pin: SHT36PRO:gpio27

# Fans
[fan]
pin = SHT36PRO:gpio14
max_power = 1.0
kick_start_time = 0.5
off_below = 0.13
cycle_time = 0.010

[heater_fan hotend_fan]
pin = SHT36PRO:gpio15
heater = extruder
heater_temp = 50.0

[fan_generic nevermore]
pin: expander:PA0
max_power: 1.0
shutdown_speed: 0
cycle_time: 0.010
hardware_pwm: False
kick_start_time: 0.100
off_below: 0.0

[fan_generic aux_cooling]
pin: FAN1
max_power: 1.0
shutdown_speed: 0
cycle_time: 0.010
hardware_pwm: False
kick_start_time: 0.100
off_below: 0.0

# Filament Sensors
[filament_switch_sensor runout_sensor]
pause_on_runout: False
# When set to True, a pause will be executed immediately after a material break
# , if False, a material break pause will not be enabled
runout_gcode: 
    RESPOND MSG="Runout Sensor Tripped - No Filament Detected"
    # PAUSE
# G-code to be executed after a material break
insert_gcode: 
    RESPOND MSG="Runout Sensor Reset - Filament Detected"
# G-code to be executed after insertion of consumables
event_delay: 3.0
# Minimum time delay between events, in seconds
pause_delay: 0.5
# Delay between pause commands, scheduling and execution of runout_gcode in seconds
# , increasing delay if strange pause behaviour occurs
switch_pin: PB1

# Accelerometers
[adxl345]
cs_pin: SHT36PRO:gpio9
spi_software_sclk_pin: SHT36PRO:gpio10
spi_software_mosi_pin: SHT36PRO:gpio11
spi_software_miso_pin: SHT36PRO:gpio12

[resonance_tester]
accel_chip: adxl345
probe_points: 
	60, 60, 20
accel_per_hz: 75
min_freq: 5
max_freq: 133
hz_per_sec: 1

# [shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.

# Display
[display]
lcd_type: sh1106
i2c_mcu: display
i2c_bus: i2c1a
encoder_pins: ^display:PA4, ^display:PA3
click_pin: ^!display:PA1
kill_pin: ^!display:PA5
x_offset: 2

# System Options
[virtual_sdcard]
path: /home/fly/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[save_variables]
filename: ~/printer_data/variables.cfg

[exclude_object]

[gcode_arcs]
resolution: 1.0

[board_pins]
aliases: 
	
	X_EN=PA3, X_STEP=PC13, X_DIR=PC1, X_CS=PB11,
	Y_EN=PD2, Y_STEP=PC14,  Y_DIR=PC4,  Y_CS=PC10,
	Z_EN=PC12,  Z_STEP=PC15, Z_DIR=PC5,  Z_CS=PB7,
	E_EN=PC11,  E_STEP=PC3,  E_DIR=PC8,  E_CS=PB6,
	
	
	BED_OUT=PA2,
	HEAT=PA0,
	
	
	BED_TEMP=PC2,
	HEAT_TEMP=PC0,
	
	
	FAN0=PC6, FAN1=PC7,
	
	
	X_STOP=PA4,  Y_STOP=PA5,  Z_STOP=PA6,
	
	
	EXP1_1=PC9,  EXP1_3=PA13,  EXP1_5=PA9,   EXP1_7=<NC>,  EXP1_9=<GND>,
	EXP1_2=PB6,  EXP1_4=PA10,  EXP1_6=PA8,   EXP1_8=<NC>,  EXP1_10=<5V>,
	
	EXP2_1=PB14, EXP2_3=PA15,  EXP2_5=PA14,  EXP2_7=PC10,   EXP2_9=<GND>,
	EXP2_2=PB13, EXP2_4=PB12,  EXP2_6=PB15,  EXP2_8=<RST>, EXP2_10=<NC>,
	
	
	
	SERVO=PB0,
	PROBE=PA1

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 41.855
#*# pid_ki = 6.976
#*# pid_kd = 62.782
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 57.203
#*# pid_ki = 2.243
#*# pid_kd = 364.670
#*#
#*# [stepper_z]
#*# position_endstop = 120.205
